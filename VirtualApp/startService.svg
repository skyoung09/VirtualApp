<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="798px" preserveAspectRatio="none" style="width:1282px;height:798px;" version="1.1" viewBox="0 0 1282 798" width="1282px" zoomAndPan="magnify"><defs><filter height="300%" id="f1rx0z4woqqmkq" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFB6C1" height="793.8086" style="stroke: #A80036; stroke-width: 1.0;" width="935.5" x="51" y="4"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="94" x="471.75" y="16.5684">Client Process</text><rect fill="#90EE90" height="793.8086" style="stroke: #A80036; stroke-width: 1.0;" width="192" x="988.5" y="4"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="98" x="1035.5" y="16.5684">Server Process</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="104" x2="104" y1="58.7988" y2="759.3203"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="242" x2="242" y1="58.7988" y2="759.3203"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="372" x2="372" y1="58.7988" y2="759.3203"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="522.5" x2="522.5" y1="58.7988" y2="759.3203"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="658.5" x2="658.5" y1="58.7988" y2="759.3203"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="769.5" x2="769.5" y1="58.7988" y2="759.3203"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="897.5" x2="897.5" y1="58.7988" y2="759.3203"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1084.5" x2="1084.5" y1="58.7988" y2="759.3203"/><rect fill="#FEFECE" filter="url(#f1rx0z4woqqmkq)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="94" x="55" y="23.3105"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="80" x="62" y="43.8457">StartService</text><rect fill="#FEFECE" filter="url(#f1rx0z4woqqmkq)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="94" x="55" y="758.3203"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="80" x="62" y="778.8555">StartService</text><rect fill="#FEFECE" filter="url(#f1rx0z4woqqmkq)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="92" x="194" y="23.3105"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="78" x="201" y="43.8457">VirtualCore</text><rect fill="#FEFECE" filter="url(#f1rx0z4woqqmkq)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="92" x="194" y="758.3203"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="78" x="201" y="778.8555">VirtualCore</text><rect fill="#FEFECE" filter="url(#f1rx0z4woqqmkq)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="141" x="300" y="23.3105"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="127" x="307" y="43.8457">ApplicationThread</text><rect fill="#FEFECE" filter="url(#f1rx0z4woqqmkq)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="141" x="300" y="758.3203"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="127" x="307" y="778.8555">ApplicationThread</text><rect fill="#FEFECE" filter="url(#f1rx0z4woqqmkq)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="112" x="464.5" y="23.3105"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="98" x="471.5" y="43.8457">ActivityThread</text><rect fill="#FEFECE" filter="url(#f1rx0z4woqqmkq)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="112" x="464.5" y="758.3203"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="98" x="471.5" y="778.8555">ActivityThread</text><rect fill="#FEFECE" filter="url(#f1rx0z4woqqmkq)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="132" x="590.5" y="23.3105"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="118" x="597.5" y="43.8457">VActivityManager</text><rect fill="#FEFECE" filter="url(#f1rx0z4woqqmkq)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="132" x="590.5" y="758.3203"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="118" x="597.5" y="778.8555">VActivityManager</text><rect fill="#FEFECE" filter="url(#f1rx0z4woqqmkq)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="62" x="736.5" y="23.3105"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="48" x="743.5" y="43.8457">Service</text><rect fill="#FEFECE" filter="url(#f1rx0z4woqqmkq)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="62" x="736.5" y="758.3203"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="48" x="743.5" y="778.8555">Service</text><rect fill="#FEFECE" filter="url(#f1rx0z4woqqmkq)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="166" x="812.5" y="23.3105"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="152" x="819.5" y="43.8457">ServiceDoneExecuting</text><rect fill="#FEFECE" filter="url(#f1rx0z4woqqmkq)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="166" x="812.5" y="758.3203"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="152" x="819.5" y="778.8555">ServiceDoneExecuting</text><rect fill="#FEFECE" filter="url(#f1rx0z4woqqmkq)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="180" x="992.5" y="23.3105"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="166" x="999.5" y="43.8457">VActivityManagerService</text><rect fill="#FEFECE" filter="url(#f1rx0z4woqqmkq)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="180" x="992.5" y="758.3203"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="166" x="999.5" y="778.8555">VActivityManagerService</text><polygon fill="#A80036" points="92,85.7988,102,89.7988,92,93.7988,96,89.7988" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="3" x2="98" y1="89.7988" y2="89.7988"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="77" x="10" y="85.3672">call(hooked)</text><polygon fill="#A80036" points="230,115.1094,240,119.1094,230,123.1094,234,119.1094" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="104" x2="236" y1="119.1094" y2="119.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="114" x="111" y="114.6777">resolveServiceInfo</text><polygon fill="#A80036" points="115,144.4199,105,148.4199,115,152.4199,111,148.4199" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="109" x2="241" y1="148.4199" y2="148.4199"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="69" x="121" y="143.9883">ServiceInfo</text><polygon fill="#A80036" points="646.5,173.7305,656.5,177.7305,646.5,181.7305,650.5,177.7305" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="104" x2="652.5" y1="177.7305" y2="177.7305"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="73" x="111" y="173.2988">startService</text><polygon fill="#A80036" points="1072.5,203.041,1082.5,207.041,1072.5,211.041,1076.5,207.041" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="658.5" x2="1078.5" y1="207.041" y2="207.041"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="73" x="665.5" y="202.6094">startService</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1084.5" x2="1126.5" y1="236.6621" y2="236.6621"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1126.5" x2="1126.5" y1="236.6621" y2="249.6621"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1085.5" x2="1126.5" y1="249.6621" y2="249.6621"/><polygon fill="#A80036" points="1095.5,245.6621,1085.5,249.6621,1095.5,253.6621,1091.5,249.6621" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="130" x="1091.5" y="231.9199">startServiceCommon</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1084.5" x2="1126.5" y1="278.9727" y2="278.9727"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1126.5" x2="1126.5" y1="278.9727" y2="291.9727"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1085.5" x2="1126.5" y1="291.9727" y2="291.9727"/><polygon fill="#A80036" points="1095.5,287.9727,1085.5,291.9727,1095.5,295.9727,1091.5,291.9727" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="163" x="1091.5" y="274.2305">startProcessIfNeedLocked</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1084.5" x2="1126.5" y1="321.2832" y2="321.2832"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1126.5" x2="1126.5" y1="321.2832" y2="334.2832"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1085.5" x2="1126.5" y1="334.2832" y2="334.2832"/><polygon fill="#A80036" points="1095.5,330.2832,1085.5,334.2832,1095.5,338.2832,1091.5,334.2832" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="1091.5" y="316.541">findRecordLocked</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1084.5" x2="1126.5" y1="363.5938" y2="363.5938"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1126.5" x2="1126.5" y1="363.5938" y2="376.5938"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1085.5" x2="1126.5" y1="376.5938" y2="376.5938"/><polygon fill="#A80036" points="1095.5,372.5938,1085.5,376.5938,1095.5,380.5938,1091.5,376.5938" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="87" x="1091.5" y="358.8516">ServiceRecord</text><polygon fill="#A80036" points="383.5,401.5938,373.5,405.5938,383.5,409.5938,379.5,405.5938" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="377.5" x2="1083.5" y1="405.5938" y2="405.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="140" x="389.5" y="401.1621">scheduleCreateService</text><polygon fill="#A80036" points="510.5,430.9043,520.5,434.9043,510.5,438.9043,514.5,434.9043" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="372.5" x2="516.5" y1="434.9043" y2="434.9043"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="126" x="379.5" y="430.4727">handleCreateService</text><polygon fill="#A80036" points="885.5,460.2148,895.5,464.2148,885.5,468.2148,889.5,464.2148" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="3" x2="891.5" y1="464.2148" y2="464.2148"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="77" x="10" y="459.7832">call(hooked)</text><polygon fill="#A80036" points="669.5,489.5254,659.5,493.5254,669.5,497.5254,665.5,493.5254" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="663.5" x2="896.5" y1="493.5254" y2="493.5254"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="675.5" y="489.0938">serviceDoneExecuting</text><polygon fill="#A80036" points="1072.5,518.8359,1082.5,522.8359,1072.5,526.8359,1076.5,522.8359" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="658.5" x2="1078.5" y1="522.8359" y2="522.8359"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="665.5" y="518.4043">serviceDoneExecuting</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1084.5" x2="1126.5" y1="552.457" y2="552.457"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1126.5" x2="1126.5" y1="552.457" y2="565.457"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1085.5" x2="1126.5" y1="565.457" y2="565.457"/><polygon fill="#A80036" points="1095.5,561.457,1085.5,565.457,1095.5,569.457,1091.5,565.457" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="190" x="1091.5" y="547.7148">requestServiceBindingsLocked</text><polygon fill="#A80036" points="383.5,590.457,373.5,594.457,383.5,598.457,379.5,594.457" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="377.5" x2="1083.5" y1="594.457" y2="594.457"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="129" x="389.5" y="590.0254">scheduleServiceArgs</text><polygon fill="#A80036" points="510.5,619.7676,520.5,623.7676,510.5,627.7676,514.5,623.7676" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="372.5" x2="516.5" y1="623.7676" y2="623.7676"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="115" x="379.5" y="619.3359">handleServiceArgs</text><polygon fill="#A80036" points="757.5,649.0781,767.5,653.0781,757.5,657.0781,761.5,653.0781" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="522.5" x2="763.5" y1="653.0781" y2="653.0781"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="529.5" y="648.6465">onStartCommand</text><polygon fill="#A80036" points="885.5,678.3887,895.5,682.3887,885.5,686.3887,889.5,682.3887" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="3" x2="891.5" y1="682.3887" y2="682.3887"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="77" x="10" y="677.957">call(hooked)</text><polygon fill="#A80036" points="669.5,707.6992,659.5,711.6992,669.5,715.6992,665.5,711.6992" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="663.5" x2="896.5" y1="711.6992" y2="711.6992"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="675.5" y="707.2676">serviceDoneExecuting</text><polygon fill="#A80036" points="1072.5,737.0098,1082.5,741.0098,1072.5,745.0098,1076.5,741.0098" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="658.5" x2="1078.5" y1="741.0098" y2="741.0098"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="665.5" y="736.5781">serviceDoneExecuting</text><!--
@startuml
box "Client Process" #LightPink
participant StartService
participant VirtualCore
participant ApplicationThread
participant ActivityThread
participant VActivityManager
participant Service
participant ServiceDoneExecuting
end box

box "Server Process" #LightGreen
participant VActivityManagerService
end box

-> StartService: call(hooked)
StartService -> VirtualCore: resolveServiceInfo
VirtualCore - -> StartService: ServiceInfo
StartService -> VActivityManager: startService
VActivityManager -> VActivityManagerService : startService
VActivityManagerService -> VActivityManagerService: startServiceCommon
VActivityManagerService -> VActivityManagerService: startProcessIfNeedLocked
VActivityManagerService -> VActivityManagerService: findRecordLocked
VActivityManagerService - -> VActivityManagerService: ServiceRecord
VActivityManagerService -> ApplicationThread: scheduleCreateService
ApplicationThread -> ActivityThread: handleCreateService
-> ServiceDoneExecuting: call(hooked)
ServiceDoneExecuting -> VActivityManager: serviceDoneExecuting
VActivityManager -> VActivityManagerService: serviceDoneExecuting
VActivityManagerService -> VActivityManagerService: requestServiceBindingsLocked
VActivityManagerService -> ApplicationThread: scheduleServiceArgs
ApplicationThread -> ActivityThread: handleServiceArgs
ActivityThread -> Service: onStartCommand
-> ServiceDoneExecuting: call(hooked)
ServiceDoneExecuting -> VActivityManager: serviceDoneExecuting
VActivityManager -> VActivityManagerService: serviceDoneExecuting
@enduml

PlantUML version 1.2017.12(Thu Apr 27 00:06:36 CST 2017)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_112-release-b06
Operating System: Mac OS X
OS Version: 10.12.5
Default Encoding: UTF-8
Language: zh
Country: CN
--></g></svg>