<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="541px" preserveAspectRatio="none" style="width:1056px;height:541px;" version="1.1" viewBox="0 0 1056 541" width="1056px" zoomAndPan="magnify"><defs><filter height="300%" id="f1ggjtgxkgv6xk" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFB6C1" height="536.6348" style="stroke: #A80036; stroke-width: 1.0;" width="831" x="30" y="4"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="94" x="398.5" y="16.5684">Client Process</text><rect fill="#90EE90" height="536.6348" style="stroke: #A80036; stroke-width: 1.0;" width="192" x="863" y="4"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="98" x="910" y="16.5684">Server Process</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="104" x2="104" y1="58.7988" y2="502.1465"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="256" x2="256" y1="58.7988" y2="502.1465"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="397" x2="397" y1="58.7988" y2="502.1465"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="533" x2="533" y1="58.7988" y2="502.1465"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="644" x2="644" y1="58.7988" y2="502.1465"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="772" x2="772" y1="58.7988" y2="502.1465"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="959" x2="959" y1="58.7988" y2="502.1465"/><rect fill="#FEFECE" filter="url(#f1ggjtgxkgv6xk)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="136" x="34" y="23.3105"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="122" x="41" y="43.8457">StopServiceToken</text><rect fill="#FEFECE" filter="url(#f1ggjtgxkgv6xk)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="136" x="34" y="501.1465"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="122" x="41" y="521.6816">StopServiceToken</text><rect fill="#FEFECE" filter="url(#f1ggjtgxkgv6xk)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="141" x="184" y="23.3105"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="127" x="191" y="43.8457">ApplicationThread</text><rect fill="#FEFECE" filter="url(#f1ggjtgxkgv6xk)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="141" x="184" y="501.1465"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="127" x="191" y="521.6816">ApplicationThread</text><rect fill="#FEFECE" filter="url(#f1ggjtgxkgv6xk)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="112" x="339" y="23.3105"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="98" x="346" y="43.8457">ActivityThread</text><rect fill="#FEFECE" filter="url(#f1ggjtgxkgv6xk)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="112" x="339" y="501.1465"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="98" x="346" y="521.6816">ActivityThread</text><rect fill="#FEFECE" filter="url(#f1ggjtgxkgv6xk)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="132" x="465" y="23.3105"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="118" x="472" y="43.8457">VActivityManager</text><rect fill="#FEFECE" filter="url(#f1ggjtgxkgv6xk)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="132" x="465" y="501.1465"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="118" x="472" y="521.6816">VActivityManager</text><rect fill="#FEFECE" filter="url(#f1ggjtgxkgv6xk)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="62" x="611" y="23.3105"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="48" x="618" y="43.8457">Service</text><rect fill="#FEFECE" filter="url(#f1ggjtgxkgv6xk)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="62" x="611" y="501.1465"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="48" x="618" y="521.6816">Service</text><rect fill="#FEFECE" filter="url(#f1ggjtgxkgv6xk)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="166" x="687" y="23.3105"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="152" x="694" y="43.8457">ServiceDoneExecuting</text><rect fill="#FEFECE" filter="url(#f1ggjtgxkgv6xk)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="166" x="687" y="501.1465"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="152" x="694" y="521.6816">ServiceDoneExecuting</text><rect fill="#FEFECE" filter="url(#f1ggjtgxkgv6xk)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="180" x="867" y="23.3105"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="166" x="874" y="43.8457">VActivityManagerService</text><rect fill="#FEFECE" filter="url(#f1ggjtgxkgv6xk)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="180" x="867" y="501.1465"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="166" x="874" y="521.6816">VActivityManagerService</text><polygon fill="#A80036" points="92,85.7988,102,89.7988,92,93.7988,96,89.7988" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="3" x2="98" y1="89.7988" y2="89.7988"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="77" x="10" y="85.3672">call(hooked)</text><polygon fill="#A80036" points="521,115.1094,531,119.1094,521,123.1094,525,119.1094" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="104" x2="527" y1="119.1094" y2="119.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="111" y="114.6777">isVAServiceToken</text><polygon fill="#A80036" points="947,144.4199,957,148.4199,947,152.4199,951,148.4199" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="533" x2="953" y1="148.4199" y2="148.4199"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="540" y="143.9883">isVAServiceToken</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="959" x2="1001" y1="178.041" y2="178.041"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1001" x2="1001" y1="178.041" y2="191.041"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="960" x2="1001" y1="191.041" y2="191.041"/><polygon fill="#A80036" points="970,187.041,960,191.041,970,195.041,966,191.041" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="50" x="966" y="173.2988">boolean</text><polygon fill="#A80036" points="544,216.041,534,220.041,544,224.041,540,220.041" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="538" x2="958" y1="220.041" y2="220.041"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="50" x="550" y="215.6094">boolean</text><polygon fill="#A80036" points="115,245.3516,105,249.3516,115,253.3516,111,249.3516" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="109" x2="532" y1="249.3516" y2="249.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="50" x="121" y="244.9199">boolean</text><polygon fill="#A80036" points="521,274.6621,531,278.6621,521,282.6621,525,278.6621" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="104" x2="527" y1="278.6621" y2="278.6621"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="111" y="274.2305">stopServiceToken</text><polygon fill="#A80036" points="947,303.9727,957,307.9727,947,311.9727,951,307.9727" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="533" x2="953" y1="307.9727" y2="307.9727"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="540" y="303.541">stopServiceToken</text><polygon fill="#A80036" points="267.5,333.2832,257.5,337.2832,267.5,341.2832,263.5,337.2832" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="261.5" x2="958" y1="337.2832" y2="337.2832"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="128" x="273.5" y="332.8516">scheduleStopService</text><polygon fill="#A80036" points="385,362.5938,395,366.5938,385,370.5938,389,366.5938" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="256.5" x2="391" y1="366.5938" y2="366.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="114" x="263.5" y="362.1621">handleStopService</text><polygon fill="#A80036" points="632,391.9043,642,395.9043,632,399.9043,636,395.9043" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="397" x2="638" y1="395.9043" y2="395.9043"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="65" x="404" y="391.4727">onDestroy</text><polygon fill="#A80036" points="760,421.2148,770,425.2148,760,429.2148,764,425.2148" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="3" x2="766" y1="425.2148" y2="425.2148"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="77" x="10" y="420.7832">call(hooked)</text><polygon fill="#A80036" points="544,450.5254,534,454.5254,544,458.5254,540,454.5254" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="538" x2="771" y1="454.5254" y2="454.5254"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="550" y="450.0938">serviceDoneExecuting</text><polygon fill="#A80036" points="947,479.8359,957,483.8359,947,487.8359,951,483.8359" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="533" x2="953" y1="483.8359" y2="483.8359"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="540" y="479.4043">serviceDoneExecuting</text><!--
@startuml
box "Client Process" #LightPink
participant StopServiceToken
participant ApplicationThread
participant ActivityThread
participant VActivityManager
participant Service
participant ServiceDoneExecuting
end box

box "Server Process" #LightGreen
participant VActivityManagerService
end box

-> StopServiceToken: call(hooked)
StopServiceToken -> VActivityManager: isVAServiceToken
VActivityManager -> VActivityManagerService : isVAServiceToken
VActivityManagerService - -> VActivityManagerService: boolean
VActivityManagerService - -> VActivityManager: boolean
VActivityManager - -> StopServiceToken: boolean
StopServiceToken -> VActivityManager: stopServiceToken
VActivityManager -> VActivityManagerService : stopServiceToken
VActivityManagerService -> ApplicationThread: scheduleStopService
ApplicationThread -> ActivityThread: handleStopService
ActivityThread -> Service: onDestroy
-> ServiceDoneExecuting: call(hooked)
ServiceDoneExecuting -> VActivityManager: serviceDoneExecuting
VActivityManager -> VActivityManagerService: serviceDoneExecuting
@enduml

PlantUML version 1.2017.12(Thu Apr 27 00:06:36 CST 2017)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_112-release-b06
Operating System: Mac OS X
OS Version: 10.12.5
Default Encoding: UTF-8
Language: zh
Country: CN
--></g></svg>