<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="681px" preserveAspectRatio="none" style="width:1962px;height:681px;" version="1.1" viewBox="0 0 1962 681" width="1962px" zoomAndPan="magnify"><defs><filter height="300%" id="fear3ocl5zk8i" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFB6C1" height="676.5664" style="stroke: #A80036; stroke-width: 1.0;" width="1249.5" x="52" y="4"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="94" x="629.75" y="16.5684">Client Process</text><rect fill="#90EE90" height="676.5664" style="stroke: #A80036; stroke-width: 1.0;" width="351" x="1303.5" y="4"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="98" x="1430" y="16.5684">Server Process</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="104" x2="104" y1="58.7988" y2="642.0781"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="279.5" x2="279.5" y1="58.7988" y2="642.0781"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="440.5" x2="440.5" y1="58.7988" y2="642.0781"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="570.5" x2="570.5" y1="58.7988" y2="642.0781"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="711.5" x2="711.5" y1="58.7988" y2="642.0781"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="837.5" x2="837.5" y1="58.7988" y2="642.0781"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="973.5" x2="973.5" y1="58.7988" y2="642.0781"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1084.5" x2="1084.5" y1="58.7988" y2="642.0781"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1212.5" x2="1212.5" y1="58.7988" y2="642.0781"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1399.5" x2="1399.5" y1="58.7988" y2="642.0781"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1575.5" x2="1575.5" y1="58.7988" y2="642.0781"/><rect fill="#FEFECE" filter="url(#fear3ocl5zk8i)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="92" x="56" y="23.3105"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="78" x="63" y="43.8457">BindService</text><rect fill="#FEFECE" filter="url(#fear3ocl5zk8i)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="92" x="56" y="641.0781"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="78" x="63" y="661.6133">BindService</text><rect fill="#FEFECE" filter="url(#fear3ocl5zk8i)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="201" x="177.5" y="23.3105"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="187" x="184.5" y="43.8457">ServiceConnectionDelegate</text><rect fill="#FEFECE" filter="url(#fear3ocl5zk8i)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="201" x="177.5" y="641.0781"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="187" x="184.5" y="661.6133">ServiceConnectionDelegate</text><rect fill="#FEFECE" filter="url(#fear3ocl5zk8i)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="92" x="392.5" y="23.3105"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="78" x="399.5" y="43.8457">VirtualCore</text><rect fill="#FEFECE" filter="url(#fear3ocl5zk8i)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="92" x="392.5" y="641.0781"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="78" x="399.5" y="661.6133">VirtualCore</text><rect fill="#FEFECE" filter="url(#fear3ocl5zk8i)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="141" x="498.5" y="23.3105"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="127" x="505.5" y="43.8457">ApplicationThread</text><rect fill="#FEFECE" filter="url(#fear3ocl5zk8i)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="141" x="498.5" y="641.0781"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="127" x="505.5" y="661.6133">ApplicationThread</text><rect fill="#FEFECE" filter="url(#fear3ocl5zk8i)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="112" x="653.5" y="23.3105"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="98" x="660.5" y="43.8457">ActivityThread</text><rect fill="#FEFECE" filter="url(#fear3ocl5zk8i)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="112" x="653.5" y="641.0781"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="98" x="660.5" y="661.6133">ActivityThread</text><rect fill="#FEFECE" filter="url(#fear3ocl5zk8i)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="112" x="779.5" y="23.3105"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="98" x="786.5" y="43.8457">PublishService</text><rect fill="#FEFECE" filter="url(#fear3ocl5zk8i)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="112" x="779.5" y="641.0781"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="98" x="786.5" y="661.6133">PublishService</text><rect fill="#FEFECE" filter="url(#fear3ocl5zk8i)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="132" x="905.5" y="23.3105"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="118" x="912.5" y="43.8457">VActivityManager</text><rect fill="#FEFECE" filter="url(#fear3ocl5zk8i)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="132" x="905.5" y="641.0781"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="118" x="912.5" y="661.6133">VActivityManager</text><rect fill="#FEFECE" filter="url(#fear3ocl5zk8i)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="62" x="1051.5" y="23.3105"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="48" x="1058.5" y="43.8457">Service</text><rect fill="#FEFECE" filter="url(#fear3ocl5zk8i)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="62" x="1051.5" y="641.0781"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="48" x="1058.5" y="661.6133">Service</text><rect fill="#FEFECE" filter="url(#fear3ocl5zk8i)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="166" x="1127.5" y="23.3105"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="152" x="1134.5" y="43.8457">ServiceDoneExecuting</text><rect fill="#FEFECE" filter="url(#fear3ocl5zk8i)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="166" x="1127.5" y="641.0781"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="152" x="1134.5" y="661.6133">ServiceDoneExecuting</text><rect fill="#FEFECE" filter="url(#fear3ocl5zk8i)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="180" x="1307.5" y="23.3105"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="166" x="1314.5" y="43.8457">VActivityManagerService</text><rect fill="#FEFECE" filter="url(#fear3ocl5zk8i)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="180" x="1307.5" y="641.0781"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="166" x="1314.5" y="661.6133">VActivityManagerService</text><rect fill="#FEFECE" filter="url(#fear3ocl5zk8i)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="145" x="1501.5" y="23.3105"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="131" x="1508.5" y="43.8457">IServiceConnection</text><rect fill="#FEFECE" filter="url(#fear3ocl5zk8i)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="145" x="1501.5" y="641.0781"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="131" x="1508.5" y="661.6133">IServiceConnection</text><polygon fill="#A80036" points="92,85.7988,102,89.7988,92,93.7988,96,89.7988" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="3" x2="98" y1="89.7988" y2="89.7988"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="77" x="10" y="85.3672">call(hooked)</text><polygon fill="#A80036" points="268,115.1094,278,119.1094,268,123.1094,272,119.1094" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="104" x2="274" y1="119.1094" y2="119.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="75" x="111" y="114.6777">getDelegate</text><polygon fill="#A80036" points="115,144.4199,105,148.4199,115,152.4199,111,148.4199" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="109" x2="279" y1="148.4199" y2="148.4199"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="121" y="143.9883">IServiceConnection.Stub</text><polygon fill="#A80036" points="961.5,173.7305,971.5,177.7305,961.5,181.7305,965.5,177.7305" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="104" x2="967.5" y1="177.7305" y2="177.7305"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="111" y="173.2988">bindService</text><polygon fill="#A80036" points="1387.5,203.041,1397.5,207.041,1387.5,211.041,1391.5,207.041" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="973.5" x2="1393.5" y1="207.041" y2="207.041"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="980.5" y="202.6094">bindService</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1399.5" x2="1441.5" y1="236.6621" y2="236.6621"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1441.5" x2="1441.5" y1="236.6621" y2="249.6621"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1400.5" x2="1441.5" y1="249.6621" y2="249.6621"/><polygon fill="#A80036" points="1410.5,245.6621,1400.5,249.6621,1410.5,253.6621,1406.5,249.6621" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="114" x="1406.5" y="231.9199">resolveServiceInfo</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1399.5" x2="1441.5" y1="278.9727" y2="278.9727"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1441.5" x2="1441.5" y1="278.9727" y2="291.9727"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1400.5" x2="1441.5" y1="291.9727" y2="291.9727"/><polygon fill="#A80036" points="1410.5,287.9727,1400.5,291.9727,1410.5,295.9727,1406.5,291.9727" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="69" x="1406.5" y="274.2305">ServiceInfo</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1399.5" x2="1441.5" y1="321.2832" y2="321.2832"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1441.5" x2="1441.5" y1="321.2832" y2="334.2832"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1400.5" x2="1441.5" y1="334.2832" y2="334.2832"/><polygon fill="#A80036" points="1410.5,330.2832,1400.5,334.2832,1410.5,338.2832,1406.5,334.2832" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="130" x="1406.5" y="316.541">startServiceCommon</text><polygon fill="#FBFB77" filter="url(#fear3ocl5zk8i)" points="1548,306.4727,1548,331.4727,1885,331.4727,1885,316.4727,1875,306.4727,1548,306.4727" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1875" x2="1875" y1="306.4727" y2="316.4727"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1885" x2="1875" y1="316.4727" y2="316.4727"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="316" x="1554" y="324.041">Service未启动，并且使用了BIND_AUTO_CREATE模式</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1399.5" x2="1441.5" y1="363.5938" y2="363.5938"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1441.5" x2="1441.5" y1="363.5938" y2="376.5938"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1400.5" x2="1441.5" y1="376.5938" y2="376.5938"/><polygon fill="#A80036" points="1410.5,372.5938,1400.5,376.5938,1410.5,380.5938,1406.5,376.5938" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="66" x="1406.5" y="358.8516">addRecord</text><polygon fill="#FBFB77" filter="url(#fear3ocl5zk8i)" points="1484,348.7832,1484,373.7832,1953,373.7832,1953,358.7832,1943,348.7832,1484,348.7832" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1943" x2="1943" y1="348.7832" y2="358.7832"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1953" x2="1943" y1="358.7832" y2="358.7832"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="448" x="1490" y="366.3516">Service未启动，并且使用了非BIND_AUTO_CREATE模式，需要记录此次bind</text><polygon fill="#A80036" points="582,401.5938,572,405.5938,582,409.5938,578,405.5938" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="576" x2="1398.5" y1="405.5938" y2="405.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="588" y="401.1621">scheduleBindService</text><polygon fill="#A80036" points="699.5,430.9043,709.5,434.9043,699.5,438.9043,703.5,434.9043" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="571" x2="705.5" y1="434.9043" y2="434.9043"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="578" y="430.4727">handleBindService</text><polygon fill="#A80036" points="1072.5,460.2148,1082.5,464.2148,1072.5,468.2148,1076.5,464.2148" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="711.5" x2="1078.5" y1="464.2148" y2="464.2148"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="718.5" y="459.7832">onBind</text><polygon fill="#A80036" points="825.5,489.5254,835.5,493.5254,825.5,497.5254,829.5,493.5254" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="3" x2="831.5" y1="493.5254" y2="493.5254"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="77" x="10" y="489.0938">call(hooked)</text><polygon fill="#A80036" points="961.5,518.8359,971.5,522.8359,961.5,526.8359,965.5,522.8359" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="837.5" x2="967.5" y1="522.8359" y2="522.8359"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="844.5" y="518.4043">publishService</text><polygon fill="#A80036" points="1387.5,548.1465,1397.5,552.1465,1387.5,556.1465,1391.5,552.1465" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="973.5" x2="1393.5" y1="552.1465" y2="552.1465"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="980.5" y="547.7148">publishService</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1399.5" x2="1441.5" y1="581.7676" y2="581.7676"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1441.5" x2="1441.5" y1="581.7676" y2="594.7676"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1400.5" x2="1441.5" y1="594.7676" y2="594.7676"/><polygon fill="#A80036" points="1410.5,590.7676,1400.5,594.7676,1410.5,598.7676,1406.5,594.7676" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="94" x="1406.5" y="577.0254">connectService</text><polygon fill="#A80036" points="1564,619.7676,1574,623.7676,1564,627.7676,1568,623.7676" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1399.5" x2="1570" y1="623.7676" y2="623.7676"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="65" x="1406.5" y="619.3359">connected</text><!--
@startuml
box "Client Process" #LightPink
participant BindService
participant ServiceConnectionDelegate
participant VirtualCore
participant ApplicationThread
participant ActivityThread
participant PublishService
participant VActivityManager
participant Service
participant ServiceDoneExecuting
end box

box "Server Process" #LightGreen
participant VActivityManagerService
participant IServiceConnection
end box

-> BindService: call(hooked)
BindService -> ServiceConnectionDelegate: getDelegate
ServiceConnectionDelegate - -> BindService: IServiceConnection.Stub
BindService -> VActivityManager: bindService
VActivityManager -> VActivityManagerService : bindService
VActivityManagerService -> VActivityManagerService: resolveServiceInfo
VActivityManagerService - -> VActivityManagerService: ServiceInfo
VActivityManagerService -> VActivityManagerService: startServiceCommon
note right
Service未启动，并且使用了BIND_AUTO_CREATE模式
end note
VActivityManagerService -> VActivityManagerService: addRecord
note right
Service未启动，并且使用了非BIND_AUTO_CREATE模式，需要记录此次bind
end note
VActivityManagerService -> ApplicationThread: scheduleBindService
ApplicationThread -> ActivityThread: handleBindService
ActivityThread -> Service: onBind
-> PublishService: call(hooked)
PublishService -> VActivityManager: publishService
VActivityManager -> VActivityManagerService: publishService
VActivityManagerService -> VActivityManagerService: connectService
VActivityManagerService -> IServiceConnection: connected
@enduml

PlantUML version 1.2017.12(Thu Apr 27 00:06:36 CST 2017)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_112-release-b06
Operating System: Mac OS X
OS Version: 10.12.5
Default Encoding: UTF-8
Language: zh
Country: CN
--></g></svg>